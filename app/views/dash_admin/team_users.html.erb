<section id="gd_users">
    
<div class="top">

    <div class="select-text">Spielgruppe wählen</div>
    <div class="select">
        <select class="cs-select cs-skin-underline form-field">
            <option value="" disabled selected><%= @team.name %></option>
            <option value="" data-link="<%= dash_admin_users_path %>">
                         Alle Teams
                    </option>
            <% @teams.each do |t| %>
                <% if t.id == @team.id %>
                    <option value="<%= t.id %>" data-class="cs-selected">
                        <%= t.name %>
                    </option>
                <% else %>
                    <option value="<%= t.id %>" data-link="<%= dash_users_path(t.id) %>">
                         <%= t.name %>
                    </option>
                <% end %>
            <% end %>
        </select>
    </div>
    
    <div class="searchbar">
        <input type="text" id="searchField" placeholder="Spieler suchen">
        <%= image_tag 'dash/search.png' %>
    </div>
</div>
   
<div class="users" id="users">
   <div id="table">
    <table id="myTable">
    <thead>
        <tr>
            <th></th>
            <th>Name</th>
            <th>Email</th>
            <th>Unternehmen</th>
            <th>Letztes Spiel</th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <% @users.each do |u| %>
        <tr class="user-row">
           <td><%= image_tag u.avatar.quad.url %></td>
            <td class="name"><%= u.fname %> <%= u.lname %></td>
            <td><%= u.email %></td>
            <td><%= u.company_name %></td>
            <td><%= Turn.where(user_id: u.id).last.updated_at.strftime('%d.%m.%Y') %></td>
            <td><%= link_to '', destroy_user_path(u), class: 'fas fa-trash-alt', data: { confirm: "Sind Sie sicher, dass Sie den User unwiederuflich löschen möchten?" } %></td>
            <td><%= link_to '', dash_admin_user_stats_path(@team, u), class: "fas fa-chart-line" %></td>
        </tr>
        <% end %>
    </tbody>
</table>
</div>
</div>
</section>


<script>
    $(document).ready( function () {
    $('#myTable').DataTable( {
        "paging":   false,
        "info":     false,
        'searching': false,
        "order": [ 1, 'asc' ],
        "columnDefs": [
            { "orderable": false, "targets": 0 },
            { "orderable": false, "targets": 5 },
            { "orderable": false, "targets": 6 },
        ]
    } );
} );
(function() {
				[].slice.call( document.querySelectorAll( 'select.cs-select' ) ).forEach( function(el) {	
					new SelectFx(el);
                    newTab: false;
				} );
			})();
    
var $rows = $('.user-row');
$('#searchField').keyup(function() {
    
    var val = '^(?=.*\\b' + $.trim($(this).val()).split(/\s+/).join('\\b)(?=.*\\b') + ').*$',
        reg = RegExp(val, 'i'),
        text;
    
    $rows.show().filter(function() {
        text = $(this).text().replace(/\s+/g, ' ');
        return !reg.test(text);
    }).hide();
});
new PerfectScrollbar('#table');
new PerfectScrollbar('.cs-options');
</script>