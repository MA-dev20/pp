<div class="blue_table">
  <div class="blue blue-place modal teamV-modal userEdit-modal" id='<%= u.new_record? ? "new_user" : "edit-user-modal#{u.id}" %>' style="display: none;">
    <div class="modal-dialog">
      <div class="modal-content">
        <button type="button" class="close modal-close" onclick="closeTeamPop()" aria-label="Close" style="transform: rotateZ(45deg);">+</button>
          <div id="table_wrapper">
            <div class="" id="list-table">
              <h1>
                <%if u.new_record? %>
                  <span>Nutzer hinzuf√ºgen</span>
                <% else %>
                  <span>Nutzer bearbeiten</span>
                <% end %>
              </h1>
              <% url = u.new_record?  ? '/users/create' : "/users/#{u.id}/update" %>
              <% type = u.new_record?  ? 'post' : "put" %>
              <%= form_for u, url: url,method: type , remote:  u.new_record? do |f| %>
                <div class="user-profile">
                    <div class="user-profile-img">
                        <div class="up-img">
                            <% if u.new_record? %>
                              <img src="<%= image_path('defaults/wolf.jpg')%>" id="imgPrevnew">
                            <% else %>
                              <img src="<%= u.avatar.present? ? u.avatar : image_path('defaults/wolf.jpg') %>" id="imgPrev<%=u.id%>">
                            <% end %>
                        </div>
                        <div class="user-profile-up">
                            <% if !u.new_record? %>
                              <%= f.file_field :avatar, onChange: "readURL(this,$('#imgPrev'+#{u.id}));"%>
                            <% else %>
                              <%= f.file_field :avatar, onChange: "readURL(this,$('#imgPrevnew'));"%>
                            <% end %>
                            <span class="plus-p"><i class="fas fa-plus"></i></span>
                        </div>
                    </div>
                </div>
                <div class="form-block">
                    <div class="row">
                        <div class="col-12 col-md-6 pr-md-4">
                            <div class="form-group">
                                <label>Unternehmen</label>
                                <%= f.text_field :company_name, class: "form-control" %>

                            </div>
                        </div>
                        <div class="col-12 col-md-6 pl-md-4">
                            <div class="form-group">
                                <label>E-Mail</label>
                                <%= f.email_field :email, class: "form-control email-field", required: true ,
                                 data: {id: "#{u.new_record? ? 'new_user' : u.id}"} %>
                                  <label id="email-error-<%= u.new_record? ? "new_user" : "#{u.id}" %>" class="error"> </label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-md-6 pr-md-4">
                            <div class="form-group">
                                <label>Vorname</label>
                                <%= f.text_field :fname, class: "form-control" %>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 pl-md-4">
                            <div class="form-group">
                                <label>Nachname</label>
                                <%= f.text_field :lname, class: "form-control" %>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="teams-block">
                    <div class="form-group bootstrapTag-group">
                        <label>Teams</label>
                        <select class="InputTags" name='user[teams][]' multiple="true" id="inputtags<%= u.id %>" data-role="tagsinput-typeahead" readonly class="rdonly">
                            <% u.teams.each do |t| %>
                                <option value="<%= t.id %>" selected><%= t.name %></option>
                            <% end %>
                        </select>
                    </div>
                </div>
                <div class="text-center">
                    <%= f.submit "#{u.new_record? ? 'Nutzer Speichern' : 'Anderungen speichern'}", class: "btn btn-green user-p-btn" %>
                </div>
                <% if !u.new_record? %>
                  <a href="#" class="delete-user" data-id="<%=u.id %>"><span class="user-opt-det"><img src="<%= asset_path('delete-m.png') %>"></span></a>
                <% end %>
              <% end %>
            </div>
        </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
  var teams;
  teams = JSON.parse('<%= u.teams.map{|team| {itemValue: team.id, itemText: "#{team.name}"}}.to_json.to_s.html_safe %>')
  var data = ["asa","AS"]
  function readURL(input, img) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();

      reader.onload = function(e) {
        img.attr('src', e.target.result);
      }

      reader.readAsDataURL(input.files[0]);
    }
  }
  function  closeTeamPop(){
      $(".blue").modal("hide");
  }
</script>