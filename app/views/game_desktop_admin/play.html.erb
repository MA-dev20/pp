<%= video_tag 'countdown.mp4', id: 'video-bg', autoplay: true %>
<section id="gd_play">
    <div class="top">
        <%= image_tag 'defaults/logo-no_shadow.png', id: 'logo' %>
        <%= image_tag @user.avatar.quad.url || '', id: 'avatar' %>
    </div>
    <div class="mid">
        <div class="countdown animated flipInX"><span class="timer" id='timerall'></span></div>
        <div id="word" data-target-resolver><%= @word.name %></div>
    </div>
</section>
<section id="skip">
   Skip mit Leertaste
</section>

<%= audio_tag("play/intro.mp3", autoplay: false, loop: true, id: 'intro') %>
<%= audio_tag(@word.sound, id: "word_sound") %>
<%= audio_tag('play/theme.mp3', id: 'theme') %>
<script type="text/javascript">
    textanim();
    document.getElementById('intro').play();
    document.getElementById("intro").volume = 0.67;
    document.getElementById("theme").volume = 0.67;
    document.getElementById("word_sound").volume = 1.0;
    
    function callback() {
        document.getElementById('video-bg').currentTime = 9;
        document.getElementById('intro').pause();
        document.getElementById('word_sound').play();
        document.getElementById('theme').play();
        MyApp.timer = startTimer('<%=@game.wait_seconds.to_i %>', document.getElementById('timerall'));
    };
    

    
    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        var setTimer = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
        
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;
            
            if (timer <= 0) {
               window.location = "<%= gda_rate_path%> "
            }
            timer--;
        }, 1000);
        var pause = function(){
            clearInterval(setTimer);
        }
        var resume = function(){
            var executed = false;
            setTimer = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);
            
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                if(executed== false){
                    $("#content").removeClass("blur")
                    $("#myModal").remove()
                    startAnimation($("#avatar"))
                    document.getElementById('video-bg').play()
                    document.getElementById('theme').play();
                    executed = true;
                }
                display.textContent = minutes + ":" + seconds;
                
                if (timer <= 0) {
                    window.location = "<%= gda_rate_path%> "
                }
                timer--;
            }, 1000);

        }
        return {pause: pause , resume: resume }
    };
    function stopAnimation(element){
        $(element).css("-webkit-animation-name", "none");
        $(element).css("animation-name", "none");
        $(element).css("-webkit-animation-duration", "none");
        $(element).css("animation-duration", "none");
        $(element).css("-webkit-animation-iteration-count", "none");
        $(element).css("animation-iteration-count", "none");
    }
    function startAnimation(element){
        $(element).css("-webkit-animation-name", "pulse");
        $(element).css("animation-name", "pulse");
        $(element).css("-webkit-animation-duration", "1.5s");
        $(element).css("animation-duration", "1.5s");
        $(element).css("-webkit-animation-iteration-count", "infinite");
        $(element).css("animation-iteration-count", "infinite");
    }

    function startTimerModal(duration, display) {
        $(function() {
            
          document.getElementById('video-bg').pause()
          document.getElementById('theme').pause();
          stopAnimation($("#avatar"))
          var current_progress = 0;
          var interval = setInterval(function() {
              current_progress += 10;
              $("#dynamic").addClass("in")
              if (current_progress >= 100){
                clearInterval(interval);
              }
          }, 1000);
        });
        MyApp.timer.pause()
        var timer = duration, minutes, seconds;
        var executed = false;
        var interval =  duration;
        var t = parseInt(duration);
        var setTimeri = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
        
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            // if(minutes == "00"){
            //     display.textContent = seconds;
            // }else{
            //     display.textContent = minutes + ":" + seconds;
            // }

            if (timer <= 0) {
                if(executed == false){
                    MyApp.timer.resume()
                    // $("#myModal").hide()
                    clearInterval(setTimeri);
                    interval = false
                    executed = true
                }
            } 
            t -- ;
            timer--;
        }, 1000);
        var pause = function(){
            clearInterval(setTimer);
        }
        return {pause: pause, time: t}

    };
    $(window).keypress(function (e) {
        if (e.key === ' ' || e.key === 'Spacebar') {
            window.location.replace('<%= gda_rate_path %>');
        };
    })
    
</script>